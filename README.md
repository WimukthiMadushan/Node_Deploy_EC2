# Node.js REST API Deployment on AWS EC2 with GitHub Actions CI/CD Pipeline

This repository demonstrates how to deploy a **Node.js REST API** on an **AWS EC2 instance** using **GitHub Actions** for CI/CD.

This is the Blog
```sh
https://medium.com/@wimukthibandara928/node-js-app-deploy-in-aws-ec2-instance-using-github-actions-for-ci-cd-dab85001d4a7
```

---

## Overview

In this project, we utilize GitHub Actions workflows to automate the CI/CD pipeline for deploying changes to our Node.js application on an EC2 instance. The workflow consists of:

- **Continuous Integration (CI):** Automatically building and testing the application on each push to the `main` branch.
- **Continuous Deployment (CD):** Automatically deploying changes to the EC2 instance upon successful completion of CI.

## Setup Instructions

Follow these steps to set up the deployment pipeline for your Node.js REST API on AWS EC2:

# AWS EC2 Instance Setup Guide

## 1. Create an EC2 Instance
Follow these steps to create and set up an EC2 instance in your AWS account:

   1. **Log in to AWS Console**  
   Navigate to the [AWS EC2 Dashboard](https://aws.amazon.com/ec2/) and click **Launch Instance**.
   ![Launch EC2 Instance](https://github.com/user-attachments/assets/abf0af94-fd16-47ec-9aab-ebb7b4b70f9d)

   2. **Configure Instance Details**  
   - Set up network configurations, such as VPC and subnets.
   - Adjust other settings like storage, security groups, and tags as needed.

   3. **Select Key Pair**  
   - Use an existing key pair or create a new one for SSH access.
   - If creating a new key pair:
     - Name the key pair.
     - Download the `.pem` file immediately after creation (this is the only time it will be available).

   4. **Launch the Instance**  
   Review the configuration and click **Launch**. Your EC2 instance will be ready in a few moments.

### Important Notes
- **Keep the `.pem` file secure.** It is required for SSH access to your EC2 instance.
- Ensure the security group associated with the instance allows SSH access (typically port 22).

   5. **Connect to the EC2 Instance from Your Local Computer**
      1. Open your terminal.  
      2. Run the following command to connect to your EC2 instance:  
      ```bash
         ssh -i your-key.pem ubuntu@your-ec2-public-ip
``
      -![image](https://github.com/user-attachments/assets/0c8bfbc1-af72-439c-af16-05ab3b1de1b6)
      
---

## 2. **Git Repository Setup:**
   - Create a new Git repository and push your Node.js code to it.

## 3. **GitHub Actions Setup:**
   - Navigate to your repository settings on GitHub and select Actions.
   - Add a self-hosted runner and follow the setup instructions.
     ![image](https://github.com/user-attachments/assets/b051d1a8-18ca-41fa-99e1-ee19f80d3e5f)


## 4. **Environment Setup for GitHub Actions:**
   - Create a `.env` file with your environment variables and add them as secrets in your GitHub repository settings.
     ![image](https://github.com/user-attachments/assets/95d49772-8731-415a-a02b-889a25cc5b74)


## 5. **CI/CD Workflows:**
   - Define CI/CD workflows in the `.github/workflows` directory.
   - Customize workflows to suit your project requirements.

## 6. **Environment Setup in EC2 Instance:**
   `sudo apt update`
   - Install Node.js and Nginx on your EC2 instance.
   - Configure Nginx as a reverse proxy for your Node.js application.
     `curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
      sudo apt-get install -y nodejs nginx
     `
     **More on nginx,

Web Server — NGINX can serve static content like HTML, CSS, and JavaScript files, as well as dynamic content generated by applications running on backend servers.

Reverse Proxy — NGINX can act as a reverse proxy server, sitting between clients and backend servers. It can distribute incoming requests to multiple backend servers based on various criteria such as load balancing algorithms, server health checks, or request routing rules. This helps improve the availability, scalability, and reliability of web applications.

Load Balancer — NGINX can function as a load balancer to distribute incoming traffic across multiple backend servers to ensure optimal resource utilization and prevent overload on any single server. It supports various load balancing algorithms and can be configured for fault tolerance and session persistence.

HTTP Cache — NGINX can cache frequently accessed content in memory or on disk to reduce latency and improve the performance of web applications. By caching static content or dynamically generated responses, NGINX can serve subsequent requests more quickly without involving the backend servers.

TLS/SSL Termination — NGINX can terminate TLS/SSL connections, offloading the encryption and decryption workload from backend servers.

Reverse Proxy for Microservices — NGINX is commonly used as a reverse proxy for microservices architectures, where it can route requests to different microservices based on URL paths, headers, or other criteria.**

   - Install PM2 to manage your Node.js process.
     `sudo npm i -g pm2
pm2 start server.js --name=apiServer`

## 7. Setting Up Nginx Reverse Proxy
   `sudo nano /etc/nginx/sites-available/default`
Add the following configuration,
 ```bash
location /api {
  rewrite ^\/api\/(.*)$ /api/$1 break;
  proxy_pass http://localhost:5000;
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```
Restart Nginx,

```bash
sudo systemctl restart nginx
```

## Workflow Explanation

- **CI Process:** On each push to the `main` branch, the workflow executes CI tasks such as checking out code, setting up the Node.js environment, installing dependencies, and running tests (if applicable).
- **CD Process:** Upon successful CI, the workflow triggers CD tasks including SSH into the EC2 instance, pulling the latest changes, restarting the Node.js application, and verifying deployment.


## Directory Structure

- `src/`: Contains the source code for the Node.js application.
- `.github/workflows/`: Contains CI/CD workflow configuration files.
- `.env`: Stores environment variables for the application.
- `server.js`: Entry point for the Node.js application.
- `package.json`: Dependency configuration for npm.

   ```

2. Customize the Node.js application code in the `server.js` file according to your requirements.

3. Push changes to the `main` branch. GitHub Actions will automatically trigger the CI/CD pipeline.

